<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="基础配置 # [mysqld] bind-address = 0.0.0.0 port = 3306 lower_case_table_names = 1 default-time-zone = &#39;Asia/Shanghai&#39; MT生产环境服务器配置 # [mysql] port=5002 prompt=\\u@\\d\\r:\\m:\\s&gt; no-auto-rehash [client] port=5002 socket=/opt/tmp/mysql.sock [mysqld] optimizer_switch=index_merge=on,index_merge_union=on,index_merge_sort_union=on,index_merge_intersection=on,engine_condition_pushdown=on,index_condition_pushdown=on,mrr=on,mrr_cost_based=on,block_nested_loop=on,batched_key_access=off,materialization=on,semijoin=on,loosescan=on,firstmatch=on,duplicateweedout=on,subquery_materialization_cost_based=on,use_index_extensions=on,condition_fanout_filter=on,derived_merge=on,prefer_ordering_index=on core_file basedir=/usr datadir=/opt/local/mysql/var/ tmpdir=/opt/tmp log-error=mysql.err # MySQL5.7的错误日志时间默认为UTC时间 调整为本地时间 log_timestamps=SYSTEM slow_query_log_file=/opt/tmp/mysql.slow general_log_file=/opt/tmp/mysql.genlog socket=/opt/tmp/mysql.sock pid-file=/opt/local/mysql/var/mysql.pid #mtsql loose_innodb_mtsql_faster_ddl=ON loose_mtsql_ddl_optimize_no_binlog=ON loose_transaction_write_set_extraction=XXHASH64 loose_binlog_transaction_dependency_tracking=WRITESET #innodb innodb_file_format=Barracuda innodb_data_home_dir=/opt/local/mysql/var/ innodb_log_group_home_dir=/opt/local/mysql/var/ innodb_data_file_path=ibdata1:100M:autoextend innodb_buffer_pool_size=40G innodb_buffer_pool_instances=4 innodb_log_files_in_group=3 innodb_log_file_size=1G innodb_log_buffer_size=16M innodb_checksum_algorithm=crc32 innodb_default_row_format=DYNAMIC internal_tmp_disk_storage_engine=innodb innodb_fast_shutdown=1 innodb_doublewrite=1 innodb_adaptive_hash_index=OFF # TODO 在打开了group commit后 是否需要设置为双1 需要进行性能测试 innodb_flush_log_at_trx_commit=1 innodb_flush_log_at_timeout=1 innodb_max_dirty_pages_pct=75 # 兼顾物理机和虚拟机 统一使用2000 对性能的提升有限 innodb_io_capacity_max默认是innodb_io_capacity的2倍 innodb_io_capacity=2000 innodb_thread_concurrency=0 innodb_read_io_threads=4 innodb_write_io_threads=16 innodb_open_files=60000 innodb_file_per_table=1 innodb_flush_method=O_DIRECT innodb_flush_neighbors=0 innodb_change_buffering=all innodb_adaptive_flushing=1 innodb_old_blocks_time=1000 innodb_use_native_aio=1 lock_wait_timeout=60 innodb_print_all_deadlocks=ON # 默认不回滚整个事务 当事务因为获得锁而超时时 交给应用处理 决定是否回滚或重试 innodb_rollback_on_timeout=0 # oltp类型的应用 应该设置的更小 innodb_lock_wait_timeout=50 innodb_buffer_pool_dump_at_shutdown=ON innodb_buffer_pool_load_at_startup=ON # MySQL5.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="基础配置" />
<meta property="og:description" content="基础配置 # [mysqld] bind-address = 0.0.0.0 port = 3306 lower_case_table_names = 1 default-time-zone = &#39;Asia/Shanghai&#39; MT生产环境服务器配置 # [mysql] port=5002 prompt=\\u@\\d\\r:\\m:\\s&gt; no-auto-rehash [client] port=5002 socket=/opt/tmp/mysql.sock [mysqld] optimizer_switch=index_merge=on,index_merge_union=on,index_merge_sort_union=on,index_merge_intersection=on,engine_condition_pushdown=on,index_condition_pushdown=on,mrr=on,mrr_cost_based=on,block_nested_loop=on,batched_key_access=off,materialization=on,semijoin=on,loosescan=on,firstmatch=on,duplicateweedout=on,subquery_materialization_cost_based=on,use_index_extensions=on,condition_fanout_filter=on,derived_merge=on,prefer_ordering_index=on core_file basedir=/usr datadir=/opt/local/mysql/var/ tmpdir=/opt/tmp log-error=mysql.err # MySQL5.7的错误日志时间默认为UTC时间 调整为本地时间 log_timestamps=SYSTEM slow_query_log_file=/opt/tmp/mysql.slow general_log_file=/opt/tmp/mysql.genlog socket=/opt/tmp/mysql.sock pid-file=/opt/local/mysql/var/mysql.pid #mtsql loose_innodb_mtsql_faster_ddl=ON loose_mtsql_ddl_optimize_no_binlog=ON loose_transaction_write_set_extraction=XXHASH64 loose_binlog_transaction_dependency_tracking=WRITESET #innodb innodb_file_format=Barracuda innodb_data_home_dir=/opt/local/mysql/var/ innodb_log_group_home_dir=/opt/local/mysql/var/ innodb_data_file_path=ibdata1:100M:autoextend innodb_buffer_pool_size=40G innodb_buffer_pool_instances=4 innodb_log_files_in_group=3 innodb_log_file_size=1G innodb_log_buffer_size=16M innodb_checksum_algorithm=crc32 innodb_default_row_format=DYNAMIC internal_tmp_disk_storage_engine=innodb innodb_fast_shutdown=1 innodb_doublewrite=1 innodb_adaptive_hash_index=OFF # TODO 在打开了group commit后 是否需要设置为双1 需要进行性能测试 innodb_flush_log_at_trx_commit=1 innodb_flush_log_at_timeout=1 innodb_max_dirty_pages_pct=75 # 兼顾物理机和虚拟机 统一使用2000 对性能的提升有限 innodb_io_capacity_max默认是innodb_io_capacity的2倍 innodb_io_capacity=2000 innodb_thread_concurrency=0 innodb_read_io_threads=4 innodb_write_io_threads=16 innodb_open_files=60000 innodb_file_per_table=1 innodb_flush_method=O_DIRECT innodb_flush_neighbors=0 innodb_change_buffering=all innodb_adaptive_flushing=1 innodb_old_blocks_time=1000 innodb_use_native_aio=1 lock_wait_timeout=60 innodb_print_all_deadlocks=ON # 默认不回滚整个事务 当事务因为获得锁而超时时 交给应用处理 决定是否回滚或重试 innodb_rollback_on_timeout=0 # oltp类型的应用 应该设置的更小 innodb_lock_wait_timeout=50 innodb_buffer_pool_dump_at_shutdown=ON innodb_buffer_pool_load_at_startup=ON # MySQL5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://christh0x.github.io/docs/wiki/research/server/mysql/%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" /><meta property="article:section" content="docs" />


<title>基础配置 | Chris Wiki</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.c58292d36b18b675680ab9baea2029204537b839ea72f258746ec0f32ce8d6c8.css" integrity="sha256-xYKS02sYtnVoCrm66iApIEU3uDnqcvJYdG7A8yzo1sg=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/zh.search.min.73f46323945b51aebfae1e2d8e5f388ca9c80010e50487163b2ffee2bddb4424.js" integrity="sha256-c/RjI5RbUa6/rh4tjl84jKnIABDlBIcWOy/&#43;4r3bRCQ=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Chris Wiki</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="搜索" aria-label="搜索" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <input type="checkbox" id="section-01a9abdd638ce3226538b97dbfe9e0d5" class="toggle"  />
    <label for="section-01a9abdd638ce3226538b97dbfe9e0d5" class="flex justify-between">
      <a href="/docs/examples/" class="">Examples</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/examples/markdown-example/" class="">MarkDown Example</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/docs/shortcuts/" class="">Shortcuts</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/shortcuts/linux-cmd/" class="">Linux Cmd</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <span>Wiki</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-55b284f1d1d8ea8e9756ba0437730f93" class="toggle" checked />
    <label for="section-55b284f1d1d8ea8e9756ba0437730f93" class="flex justify-between">
      <a role="button" class="">Research</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7e17e091a6475277823949d0ecda27ed" class="toggle"  />
    <label for="section-7e17e091a6475277823949d0ecda27ed" class="flex justify-between">
      <a role="button" class="">java</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-69e6271c7cbfbf74085430ec02bbba5c" class="toggle"  />
    <label for="section-69e6271c7cbfbf74085430ec02bbba5c" class="flex justify-between">
      <a role="button" class="">Spring</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/spring/spring-express-language/" class="">Spring Express Language</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b8650b79cdaaeb51e1fda708c92957f6" class="toggle"  />
    <label for="section-b8650b79cdaaeb51e1fda708c92957f6" class="flex justify-between">
      <a href="/docs/wiki/research/java/springsecurity/" class="">Spring Security</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/springsecurity/%E6%94%AF%E6%8C%81json%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BA%A4/" class="">支持json数据提交</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/springsecurity/springsecurityoauth%E8%AE%A4%E8%AF%81%E8%BF%87%E7%A8%8B/" class="">SpringSecurityOauth认证过程</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f87c064c1f6d088c4c939042868c188a" class="toggle"  />
    <label for="section-f87c064c1f6d088c4c939042868c188a" class="flex justify-between">
      <a role="button" class="">Spring Boot</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/springboot/%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E7%9A%84servlethttprequest/" class="">可重复读的ServletHttpRequest</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/springboot/xss%E6%94%BB%E5%87%BB%E6%8B%A6%E6%88%AA/" class="">Xss攻击拦截</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a3e833bd9bf8759dcc9c5198d5d733b8" class="toggle"  />
    <label for="section-a3e833bd9bf8759dcc9c5198d5d733b8" class="flex justify-between">
      <a role="button" class="">Spring Cloud</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/springcloud/feignclient%E6%89%93%E5%8D%B0%E8%AF%B7%E6%B1%82%E6%97%A5%E5%BF%97/" class="">FeignClient打印请求日志</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7debb0148ca8816bc8aef24f5ac0384d" class="toggle"  />
    <label for="section-7debb0148ca8816bc8aef24f5ac0384d" class="flex justify-between">
      <a role="button" class="">BIRT</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/birt/%E5%B8%B8%E7%94%A8%E8%B7%AF%E7%94%B1/" class="">Birt常用路由</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6c7f7bd098c93fa7fa4affecc3bc01dc" class="toggle"  />
    <label for="section-6c7f7bd098c93fa7fa4affecc3bc01dc" class="flex justify-between">
      <a role="button" class="">Java插件化</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/java%E6%8F%92%E4%BB%B6%E5%8C%96/%E5%90%8E%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91%E6%80%9D%E8%80%83%E4%B8%8E%E5%AE%9E%E8%B7%B5/" class="">后端模块化开发思考与实践</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/java%E6%8F%92%E4%BB%B6%E5%8C%96/%E5%87%A0%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F/" class="">几种实现方式</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-80646043de6a1bb9cf4323ad5a16dd9f" class="toggle"  />
    <label for="section-80646043de6a1bb9cf4323ad5a16dd9f" class="flex justify-between">
      <a role="button" class="">poi</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/poi/word2pdf/" class="">word2pdf</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/hotspot%E6%98%AF%E4%BB%80%E4%B9%88/" class="">HotSpot是什么？</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/arthas/" class="">Arthas 使用</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/jar%E5%8C%85%E6%93%8D%E4%BD%9C/" class="">Jar包操作</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/java/%E4%BF%9D%E6%8C%81%E9%A1%BA%E5%BA%8F%E7%9A%84properties%E7%B1%BB/" class="">保持顺序的Properties类</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6fc3a1d8166a9bd16e7386655c1caf20" class="toggle"  />
    <label for="section-6fc3a1d8166a9bd16e7386655c1caf20" class="flex justify-between">
      <a role="button" class="">bigdata</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2fa5cd1e8d425a332aab7fd6a3c6bd1a" class="toggle"  />
    <label for="section-2fa5cd1e8d425a332aab7fd6a3c6bd1a" class="flex justify-between">
      <a role="button" class="">ecmascript</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/ecmascript/%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/" class="">环境部署</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/ecmascript/%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%92%8C%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83/" class="">运行环境和项目环境</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-bfdfed148894f5c66f7678fbb72e9b63" class="toggle"  />
    <label for="section-bfdfed148894f5c66f7678fbb72e9b63" class="flex justify-between">
      <a role="button" class="">python</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/python/%E5%90%AF%E7%94%A8%E6%9C%AC%E5%9C%B0http%E6%9C%8D%E5%8A%A1/" class="">启用本地http服务</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e08891e42827080dbe19b39b7297cee5" class="toggle" checked />
    <label for="section-e08891e42827080dbe19b39b7297cee5" class="flex justify-between">
      <a role="button" class="">server</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-403ea633adab7061d651dfeb41d62f4f" class="toggle"  />
    <label for="section-403ea633adab7061d651dfeb41d62f4f" class="flex justify-between">
      <a role="button" class="">linux</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/server/linux/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="">常用命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/server/linux/grep/" class="">grep</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-25d4425fd50e16051450b1fbfb7d8a0c" class="toggle"  />
    <label for="section-25d4425fd50e16051450b1fbfb7d8a0c" class="flex justify-between">
      <a role="button" class="">nginx</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/server/nginx/%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" class="">基础配置</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3ee56196a2f02f5e39ca3dd6943702cd" class="toggle" checked />
    <label for="section-3ee56196a2f02f5e39ca3dd6943702cd" class="flex justify-between">
      <a role="button" class="">mysql</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/server/mysql/%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/" class="active">基础配置</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-78f63e3f1d7137fdd5def7aabd188b68" class="toggle"  />
    <label for="section-78f63e3f1d7137fdd5def7aabd188b68" class="flex justify-between">
      <a href="/docs/wiki/research/kubenetes/" class="">kubenetes</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/research/kubenetes/overview/" class="">Overview</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-78f14cfd37f81ea6255ac33f349e9bc7" class="toggle"  />
    <label for="section-78f14cfd37f81ea6255ac33f349e9bc7" class="flex justify-between">
      <a role="button" class="">Resources</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8677ac40f74b0778dfe9af060940096a" class="toggle"  />
    <label for="section-8677ac40f74b0778dfe9af060940096a" class="flex justify-between">
      <a role="button" class="">windows</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-066eec9db899891794ed5270712deaff" class="toggle"  />
    <label for="section-066eec9db899891794ed5270712deaff" class="flex justify-between">
      <a href="/docs/wiki/resources/macosx/" class="">macosx</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/macosx/iterm/" class="">iTerm</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/macosx/alfred/" class="">Alfred</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/macosx/%E6%A0%B9%E7%9B%AE%E5%BD%95%E5%88%9B%E5%BB%BA%E6%96%B0%E6%96%87%E4%BB%B6%E5%A4%B9/" class="">根目录创建新文件夹</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/macosx/%E9%99%90%E5%88%B6%E6%9F%90%E4%B8%AA%E8%BF%9B%E7%A8%8Bcpu/" class="">限制某个进程的CPU</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e4ec56a36961c6ce5535f9a0af80c203" class="toggle"  />
    <label for="section-e4ec56a36961c6ce5535f9a0af80c203" class="flex justify-between">
      <a role="button" class="">ios</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e94dbe3ce251c93a4e47358586766dbd" class="toggle"  />
    <label for="section-e94dbe3ce251c93a4e47358586766dbd" class="flex justify-between">
      <a role="button" class="">chrome</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ee03214cbea939ca9006ed93b632fbd4" class="toggle"  />
    <label for="section-ee03214cbea939ca9006ed93b632fbd4" class="flex justify-between">
      <a href="/docs/wiki/resources/chrome/tampermonkey/" class="">tampermonkey</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/chrome/tampermonkey/%E7%9F%A5%E4%B9%8E%E5%8E%BB%E6%A0%87%E9%A2%98%E5%92%8C%E5%B9%BF%E5%91%8A/" class="">知乎去标题和广告</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/chrome/tampermonkey/%E7%AE%80%E4%B9%A6%E5%8E%BB%E6%A0%87%E9%A2%98%E5%92%8C%E5%B9%BF%E5%91%8A/" class="">简书去标题和广告</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/chrome/tampermonkey/bilibili%E5%8E%BB%E6%A0%87%E9%A2%98%E5%92%8C%E5%B9%BF%E5%91%8A/" class="">Bilibili去标题和广告</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/chrome/%E5%AE%89%E8%A3%85%E6%97%A7%E7%89%88%E6%9C%ACchrome/" class="">安装旧版本Chrome</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-1dd417a648544b30d1493af059e7b26e" class="toggle"  />
    <label for="section-1dd417a648544b30d1493af059e7b26e" class="flex justify-between">
      <a role="button" class="">server</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ff77ea8d647adba761a900a5c221184e" class="toggle"  />
    <label for="section-ff77ea8d647adba761a900a5c221184e" class="flex justify-between">
      <a role="button" class="">common</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/server/common/%E5%9F%9F%E5%90%8D%E7%94%B3%E8%AF%B7/" class="">域名申请</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/server/common/cdn/" class="">CDN</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/server/common/vpn/" class="">VPN</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-8b179178da9845e3d4257e279ef4ccdf" class="toggle"  />
    <label for="section-8b179178da9845e3d4257e279ef4ccdf" class="flex justify-between">
      <a role="button" class="">hugo</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/server/hugo/hugo-wiki-example/" class="">Hugo Wiki Example</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9ddda78a5df4adc6a4c6a4ffbec23f03" class="toggle"  />
    <label for="section-9ddda78a5df4adc6a4c6a4ffbec23f03" class="flex justify-between">
      <a role="button" class="">git</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/git/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="">Git常用命令</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/git/%E4%BD%BF%E7%94%A8github%E4%BD%9C%E4%B8%BAmaven%E5%BA%93/" class="">使用Github作为Maven库</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/git/%E4%BD%BF%E7%94%A8github%E4%BD%9C%E4%B8%BA%E8%B5%84%E6%BA%90%E5%BA%93%E5%9B%BE%E5%BA%8A/" class="">使用Github作为资源库(图床)</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/git/raw.githubusercontent%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE/" class="">raw.githubusercontent无法访问</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/git/amwiki/" class="">AmWiki</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f9b58bcbd7e2e391732ef5afbcbb391d" class="toggle"  />
    <label for="section-f9b58bcbd7e2e391732ef5afbcbb391d" class="flex justify-between">
      <a href="/docs/wiki/resources/idea/" class="">idea</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/resources/idea/idea-%E6%8F%92%E4%BB%B6/" class="">IDEA 插件</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0b081a8e45b8f23b35bddfeafc84a3da" class="toggle"  />
    <label for="section-0b081a8e45b8f23b35bddfeafc84a3da" class="flex justify-between">
      <a role="button" class="">Work</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f9bb44a595f28046a79f48645b361499" class="toggle"  />
    <label for="section-f9bb44a595f28046a79f48645b361499" class="flex justify-between">
      <a role="button" class="">3xx</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-05030d52ac36ba6e110ffccd18b3a1a4" class="toggle"  />
    <label for="section-05030d52ac36ba6e110ffccd18b3a1a4" class="flex justify-between">
      <a role="button" class="">mdp</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b7d169d08d802e8e596e7a3ef148b7ca" class="toggle"  />
    <label for="section-b7d169d08d802e8e596e7a3ef148b7ca" class="flex justify-between">
      <a role="button" class="">k8s故障管理</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/wiki/work/mdp/k8s%E6%95%85%E9%9A%9C%E7%AE%A1%E7%90%86/%E9%98%BF%E9%87%8C%E4%BA%91%E8%8A%82%E7%82%B9%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%B5%81%E7%A8%8B/" class="">阿里云节点异常问题排查流程</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-769edb45934884090f96d6b0b0ff663e" class="toggle"  />
    <label for="section-769edb45934884090f96d6b0b0ff663e" class="flex justify-between">
      <a role="button" class="">Others</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>基础配置</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#基础配置">基础配置</a></li>
    <li><a href="#mt生产环境服务器配置">MT生产环境服务器配置</a></li>
    <li><a href="#配置解析">配置解析</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h2 id="基础配置">
  基础配置
  <a class="anchor" href="#%e5%9f%ba%e7%a1%80%e9%85%8d%e7%bd%ae">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqld<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>bind-address <span style="color:#f92672">=</span> 0.0.0.0
</span></span><span style="display:flex;"><span>port <span style="color:#f92672">=</span> <span style="color:#ae81ff">3306</span>
</span></span><span style="display:flex;"><span>lower_case_table_names <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>default-time-zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Asia/Shanghai&#39;</span>
</span></span></code></pre></div><h2 id="mt生产环境服务器配置">
  MT生产环境服务器配置
  <a class="anchor" href="#mt%e7%94%9f%e4%ba%a7%e7%8e%af%e5%a2%83%e6%9c%8d%e5%8a%a1%e5%99%a8%e9%85%8d%e7%bd%ae">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>mysql<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>port<span style="color:#f92672">=</span><span style="color:#ae81ff">5002</span>
</span></span><span style="display:flex;"><span>prompt<span style="color:#f92672">=</span><span style="color:#ae81ff">\\</span>u@<span style="color:#ae81ff">\\</span>d<span style="color:#ae81ff">\\</span>r:<span style="color:#ae81ff">\\</span>m:<span style="color:#ae81ff">\\</span>s&gt;
</span></span><span style="display:flex;"><span>no-auto-rehash
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>client<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>port<span style="color:#f92672">=</span><span style="color:#ae81ff">5002</span>
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/opt/tmp/mysql.sock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqld<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>optimizer_switch<span style="color:#f92672">=</span>index_merge<span style="color:#f92672">=</span>on,index_merge_union<span style="color:#f92672">=</span>on,index_merge_sort_union<span style="color:#f92672">=</span>on,index_merge_intersection<span style="color:#f92672">=</span>on,engine_condition_pushdown<span style="color:#f92672">=</span>on,index_condition_pushdown<span style="color:#f92672">=</span>on,mrr<span style="color:#f92672">=</span>on,mrr_cost_based<span style="color:#f92672">=</span>on,block_nested_loop<span style="color:#f92672">=</span>on,batched_key_access<span style="color:#f92672">=</span>off,materialization<span style="color:#f92672">=</span>on,semijoin<span style="color:#f92672">=</span>on,loosescan<span style="color:#f92672">=</span>on,firstmatch<span style="color:#f92672">=</span>on,duplicateweedout<span style="color:#f92672">=</span>on,subquery_materialization_cost_based<span style="color:#f92672">=</span>on,use_index_extensions<span style="color:#f92672">=</span>on,condition_fanout_filter<span style="color:#f92672">=</span>on,derived_merge<span style="color:#f92672">=</span>on,prefer_ordering_index<span style="color:#f92672">=</span>on
</span></span><span style="display:flex;"><span>core_file
</span></span><span style="display:flex;"><span>basedir<span style="color:#f92672">=</span>/usr
</span></span><span style="display:flex;"><span>datadir<span style="color:#f92672">=</span>/opt/local/mysql/var/
</span></span><span style="display:flex;"><span>tmpdir<span style="color:#f92672">=</span>/opt/tmp
</span></span><span style="display:flex;"><span>log-error<span style="color:#f92672">=</span>mysql.err
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL5.7的错误日志时间默认为UTC时间 调整为本地时间</span>
</span></span><span style="display:flex;"><span>log_timestamps<span style="color:#f92672">=</span>SYSTEM
</span></span><span style="display:flex;"><span>slow_query_log_file<span style="color:#f92672">=</span>/opt/tmp/mysql.slow
</span></span><span style="display:flex;"><span>general_log_file<span style="color:#f92672">=</span>/opt/tmp/mysql.genlog
</span></span><span style="display:flex;"><span>socket<span style="color:#f92672">=</span>/opt/tmp/mysql.sock
</span></span><span style="display:flex;"><span>pid-file<span style="color:#f92672">=</span>/opt/local/mysql/var/mysql.pid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#mtsql</span>
</span></span><span style="display:flex;"><span>loose_innodb_mtsql_faster_ddl<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>loose_mtsql_ddl_optimize_no_binlog<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>loose_transaction_write_set_extraction<span style="color:#f92672">=</span>XXHASH64
</span></span><span style="display:flex;"><span>loose_binlog_transaction_dependency_tracking<span style="color:#f92672">=</span>WRITESET
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#innodb</span>
</span></span><span style="display:flex;"><span>innodb_file_format<span style="color:#f92672">=</span>Barracuda
</span></span><span style="display:flex;"><span>innodb_data_home_dir<span style="color:#f92672">=</span>/opt/local/mysql/var/
</span></span><span style="display:flex;"><span>innodb_log_group_home_dir<span style="color:#f92672">=</span>/opt/local/mysql/var/
</span></span><span style="display:flex;"><span>innodb_data_file_path<span style="color:#f92672">=</span>ibdata1:100M:autoextend
</span></span><span style="display:flex;"><span>innodb_buffer_pool_size<span style="color:#f92672">=</span>40G
</span></span><span style="display:flex;"><span>innodb_buffer_pool_instances<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>innodb_log_files_in_group<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>innodb_log_file_size<span style="color:#f92672">=</span>1G
</span></span><span style="display:flex;"><span>innodb_log_buffer_size<span style="color:#f92672">=</span>16M
</span></span><span style="display:flex;"><span>innodb_checksum_algorithm<span style="color:#f92672">=</span>crc32
</span></span><span style="display:flex;"><span>innodb_default_row_format<span style="color:#f92672">=</span>DYNAMIC
</span></span><span style="display:flex;"><span>internal_tmp_disk_storage_engine<span style="color:#f92672">=</span>innodb
</span></span><span style="display:flex;"><span>innodb_fast_shutdown<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_doublewrite<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_adaptive_hash_index<span style="color:#f92672">=</span>OFF
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># TODO 在打开了group commit后 是否需要设置为双1 需要进行性能测试</span>
</span></span><span style="display:flex;"><span>innodb_flush_log_at_trx_commit<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_flush_log_at_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_max_dirty_pages_pct<span style="color:#f92672">=</span><span style="color:#ae81ff">75</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 兼顾物理机和虚拟机 统一使用2000 对性能的提升有限 innodb_io_capacity_max默认是innodb_io_capacity的2倍</span>
</span></span><span style="display:flex;"><span>innodb_io_capacity<span style="color:#f92672">=</span><span style="color:#ae81ff">2000</span>
</span></span><span style="display:flex;"><span>innodb_thread_concurrency<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_read_io_threads<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>innodb_write_io_threads<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>innodb_open_files<span style="color:#f92672">=</span><span style="color:#ae81ff">60000</span>
</span></span><span style="display:flex;"><span>innodb_file_per_table<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_flush_method<span style="color:#f92672">=</span>O_DIRECT
</span></span><span style="display:flex;"><span>innodb_flush_neighbors<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>innodb_change_buffering<span style="color:#f92672">=</span>all
</span></span><span style="display:flex;"><span>innodb_adaptive_flushing<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>innodb_old_blocks_time<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>innodb_use_native_aio<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>lock_wait_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>innodb_print_all_deadlocks<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 默认不回滚整个事务 当事务因为获得锁而超时时 交给应用处理 决定是否回滚或重试</span>
</span></span><span style="display:flex;"><span>innodb_rollback_on_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># oltp类型的应用 应该设置的更小</span>
</span></span><span style="display:flex;"><span>innodb_lock_wait_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>innodb_buffer_pool_dump_at_shutdown<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>innodb_buffer_pool_load_at_startup<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL5.7在启动和关闭的时候转储bp的页面比例 MySQL5.7默认设置为25 调整为100</span>
</span></span><span style="display:flex;"><span>innodb_buffer_pool_dump_pct<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL5.7默认不允许语法错误 默认值为ON 调整为OFF</span>
</span></span><span style="display:flex;"><span>innodb_strict_mode<span style="color:#f92672">=</span>OFF
</span></span><span style="display:flex;"><span>innodb_buffer_pool_chunk_size<span style="color:#f92672">=</span>128M
</span></span><span style="display:flex;"><span>max_heap_table_size<span style="color:#f92672">=</span>128M
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 默认隔离级别为RR</span>
</span></span><span style="display:flex;"><span>transaction-isolation<span style="color:#f92672">=</span>REPEATABLE-READ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>default-time-zone<span style="color:#f92672">=</span>+08:00
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#myisam</span>
</span></span><span style="display:flex;"><span>key_buffer_size<span style="color:#f92672">=</span>32M
</span></span><span style="display:flex;"><span>myisam_sort_buffer_size<span style="color:#f92672">=</span>128M
</span></span><span style="display:flex;"><span>concurrent_insert<span style="color:#f92672">=</span>ALWAYS
</span></span><span style="display:flex;"><span>delayed_insert_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span>read_rnd_buffer_size<span style="color:#f92672">=</span>128K
</span></span><span style="display:flex;"><span>myisam-recover-options<span style="color:#f92672">=</span>default
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#replication</span>
</span></span><span style="display:flex;"><span>skip-slave-start
</span></span><span style="display:flex;"><span>relay-log<span style="color:#f92672">=</span>relay
</span></span><span style="display:flex;"><span>slave_load_tmpdir<span style="color:#f92672">=</span>/opt/tmp
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 默认开启group commit</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># TODO 需要通过压测测试出最佳组合</span>
</span></span><span style="display:flex;"><span>binlog_group_commit_sync_delay<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 短路条件</span>
</span></span><span style="display:flex;"><span>binlog_group_commit_sync_no_delay_count<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 使用logical_clock</span>
</span></span><span style="display:flex;"><span>slave_parallel_type<span style="color:#f92672">=</span>logical_clock
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 物理机共40核 虚拟机一般8核 需要兼顾</span>
</span></span><span style="display:flex;"><span>slave_parallel_workers<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># TODO 该参数的值必须必max_allowed_packet大</span>
</span></span><span style="display:flex;"><span>slave_pending_jobs_size_max<span style="color:#f92672">=</span>16M
</span></span><span style="display:flex;"><span>binlog_order_commits<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 为了确保事务的顺序 一定需要设置slave_preserve_commit_order=1 否则从库上事务回放的顺序可能和主库上不一致</span>
</span></span><span style="display:flex;"><span>slave_preserve_commit_order<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>binlog_gtid_simple_recovery<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#binlog</span>
</span></span><span style="display:flex;"><span>log-bin<span style="color:#f92672">=</span>mysql-bin
</span></span><span style="display:flex;"><span>server_id<span style="color:#f92672">=</span><span style="color:#ae81ff">17117478</span>
</span></span><span style="display:flex;"><span>report_host<span style="color:#f92672">=</span>10.171.174.78
</span></span><span style="display:flex;"><span>report-port<span style="color:#f92672">=</span><span style="color:#ae81ff">5002</span>
</span></span><span style="display:flex;"><span>binlog_cache_size<span style="color:#f92672">=</span>1M
</span></span><span style="display:flex;"><span>max_binlog_cache_size<span style="color:#f92672">=</span>2G
</span></span><span style="display:flex;"><span>max_binlog_size<span style="color:#f92672">=</span>1024M
</span></span><span style="display:flex;"><span>binlog-format<span style="color:#f92672">=</span>ROW
</span></span><span style="display:flex;"><span><span style="color:#75715e"># TODO 是否使用双1 需要设置</span>
</span></span><span style="display:flex;"><span>sync_binlog<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>log-slave-updates
</span></span><span style="display:flex;"><span>read_only<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>expire_logs_days<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>max_binlog_files<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>binlog_rows_query_log_events<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL5.7默认值设置为ABORT_SERVER 在binlog损坏时直接关闭server 调整为IGNORE_ERROR 后续可以讨论是否在binlog损坏时直接关闭server</span>
</span></span><span style="display:flex;"><span>binlog_error_action<span style="color:#f92672">=</span>ABORT_SERVER
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#server</span>
</span></span><span style="display:flex;"><span>default-storage-engine<span style="color:#f92672">=</span>INNODB
</span></span><span style="display:flex;"><span>character-set-server<span style="color:#f92672">=</span>utf8mb4
</span></span><span style="display:flex;"><span>collation_server<span style="color:#f92672">=</span>utf8mb4_unicode_ci
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL5.7文档中包含character-set-client参数 但启动时不能设置该参数 所以为了兼容性考虑设置为loose-character-set-client</span>
</span></span><span style="display:flex;"><span>loose-character-set-client<span style="color:#f92672">=</span>utf8mb4
</span></span><span style="display:flex;"><span>open_files_limit<span style="color:#f92672">=</span><span style="color:#ae81ff">140000</span>
</span></span><span style="display:flex;"><span>log_slow_admin_statements<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>log_slow_verbosity<span style="color:#f92672">=</span>microtime,query_plan
</span></span><span style="display:flex;"><span>log_warnings<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># log_queries_not_using_indexes=1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># log_throttle_queries_not_using_indexes=60</span>
</span></span><span style="display:flex;"><span>long_query_time<span style="color:#f92672">=</span>0.1
</span></span><span style="display:flex;"><span>slow_query_log<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>log_slow_slave_statements<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>query_cache_type<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>query_cache_size<span style="color:#f92672">=</span>256M
</span></span><span style="display:flex;"><span>query_cache_limit<span style="color:#f92672">=</span>1M
</span></span><span style="display:flex;"><span>query_cache_min_res_unit<span style="color:#f92672">=</span>1K
</span></span><span style="display:flex;"><span>table_definition_cache<span style="color:#f92672">=</span><span style="color:#ae81ff">65536</span>
</span></span><span style="display:flex;"><span>table_open_cache<span style="color:#f92672">=</span><span style="color:#ae81ff">65536</span>
</span></span><span style="display:flex;"><span>thread_stack<span style="color:#f92672">=</span>512K
</span></span><span style="display:flex;"><span>thread_cache_size<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>sort_buffer_size<span style="color:#f92672">=</span>8M
</span></span><span style="display:flex;"><span>join_buffer_size<span style="color:#f92672">=</span>8M
</span></span><span style="display:flex;"><span>read_buffer_size<span style="color:#f92672">=</span>128K
</span></span><span style="display:flex;"><span>port<span style="color:#f92672">=</span><span style="color:#ae81ff">5002</span>
</span></span><span style="display:flex;"><span>skip-name-resolve
</span></span><span style="display:flex;"><span>skip-ssl
</span></span><span style="display:flex;"><span>max_connections<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>max_connect_errors<span style="color:#f92672">=</span><span style="color:#ae81ff">65536</span>
</span></span><span style="display:flex;"><span>max_allowed_packet<span style="color:#f92672">=</span>16M
</span></span><span style="display:flex;"><span>connect_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>net_read_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>net_write_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>slave_net_timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>back_log<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>innodb_stats_on_metadata<span style="color:#f92672">=</span>OFF
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#MySQL5.7默认打印1592错误到日志文件 调整为OFF默认不打印</span>
</span></span><span style="display:flex;"><span>log_statements_unsafe_for_binlog<span style="color:#f92672">=</span>OFF
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#MySQL5.7默认打开performance_schema</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 测试数据表明PS打开对性能影响非常小</span>
</span></span><span style="display:flex;"><span>performance_schema<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span><span style="color:#75715e">#information_schema.global_status从5.7.6开始被舍弃 MySQL5.7默认为OFF 不打开兼容模式 为了确保当前监控正常 调整默认值为ON</span>
</span></span><span style="display:flex;"><span>show_compatibility_56<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gtid_mode<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>enforce-gtid-consistency<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#replicate</span>
</span></span><span style="display:flex;"><span>relay_log_recovery<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>relay_log_info_repository<span style="color:#f92672">=</span>TABLE
</span></span><span style="display:flex;"><span>master_info_repository<span style="color:#f92672">=</span>TABLE
</span></span><span style="display:flex;"><span>slave_compressed_protocol<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#userstat</span>
</span></span><span style="display:flex;"><span>userstat<span style="color:#f92672">=</span>ON
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#user MySQL5.7增加用户密码过期策略 调整为默认用户密码不过期</span>
</span></span><span style="display:flex;"><span>default_password_lifetime<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 过载保护存在的问题较多 使用pt-kill来实现</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># max_execution_time=2000</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># kill_idle_transaction=1000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># audit log plugin setting</span>
</span></span><span style="display:flex;"><span>loose_audit_log_policy<span style="color:#f92672">=</span>NONE
</span></span><span style="display:flex;"><span>loose_audit_log_format<span style="color:#f92672">=</span>JSON
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sql_mode调整为和MySQL5.6一致</span>
</span></span><span style="display:flex;"><span>sql_mode<span style="color:#f92672">=</span>NO_ENGINE_SUBSTITUTION
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># load data/select .. into outfile的目录 设置为空和MySQL5.6一致</span>
</span></span><span style="display:flex;"><span>secure_file_priv<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 增加extra_port</span>
</span></span><span style="display:flex;"><span>extra_port<span style="color:#f92672">=</span><span style="color:#ae81ff">5003</span>
</span></span><span style="display:flex;"><span>extra_max_connections<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>
</span></span></code></pre></div><h2 id="配置解析">
  配置解析
  <a class="anchor" href="#%e9%85%8d%e7%bd%ae%e8%a7%a3%e6%9e%90">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># 设置MySQL客户端的选项</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>client<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 客户端连接服务器端时使用的端口号, 默认为3306</span>
</span></span><span style="display:flex;"><span>port <span style="color:#f92672">=</span> <span style="color:#ae81ff">3306</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># socket文件</span>
</span></span><span style="display:flex;"><span>socket <span style="color:#f92672">=</span> /tmp/mysql.sock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 支持较大的数据库转储, 导出非常巨大的表时需要此项</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#quick = </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 服务所能处理的请求包的最大大小以及服务所能处理的最大的请求大小</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 当与大的BLOB字段一起工作时相当必要, 每个连接独立的大小, 大小动态增加</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#max_allowed_packet = </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置MySQL服务器的各种选项</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqld<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 监听地址</span>
</span></span><span style="display:flex;"><span>bind-address <span style="color:#f92672">=</span> 0.0.0.0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 监听端口号, 默认3306</span>
</span></span><span style="display:flex;"><span>port <span style="color:#f92672">=</span> <span style="color:#ae81ff">3306</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># socket文件</span>
</span></span><span style="display:flex;"><span>socket <span style="color:#f92672">=</span> /tmp/mysql.sock
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pid文件</span>
</span></span><span style="display:flex;"><span>pid-file <span style="color:#f92672">=</span> /data/mysql/mysql.pid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行用户</span>
</span></span><span style="display:flex;"><span>user <span style="color:#f92672">=</span> mysql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 运行目录</span>
</span></span><span style="display:flex;"><span>basedir <span style="color:#f92672">=</span> /usr/local/mysql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 数据目录</span>
</span></span><span style="display:flex;"><span>datadir <span style="color:#f92672">=</span> /data/mysql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置mysql系统的默认时区, 也可以配置成 &#39;+08:00&#39;</span>
</span></span><span style="display:flex;"><span>default-time-zone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Asia/Shanghai&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 本机的序号, 通常1为master</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># server-id = 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 禁止对外部连接进行DNS解析, 使用这一选项可以消除MySQL进行DNS解析的时间 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果开启该选项, 则所有远程主机连接授权都要使用IP地址方式, 否则MySQL将无法正常处理连接请</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># skip-name-resolve</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 是否允许远程连接, true: 仅允许本地连接, 默认false</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># skip-networking = false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 连接最大队列量, 当连接数超过max_connections时, 新请求缓存在back_log堆栈中等待实际连接池释放</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># back_log = 600</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 最大连接数, 通过&#39;conn%&#39;查看当前状态的连接数量, 决定该值的大小</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># max_connections = 1000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 对于同一主机, 如果有超出该参数值个数的中断错误连接, 则该主机将被禁止连接</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如需对该主机进行解禁, 执行: FLUSH HOST</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># max_connect_errors = 6000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 打开的文件描述符限制, 默认最小1024</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 当open_files_limit没有被配置的时, 取 MAX(max_connections*5, ulimit -n)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 当open_files_limit被配置的时, 取 MAX(open_files_limit, max_connections*5)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># open_files_limit = 65535</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL每打开一个表, 都会读入一些数据到table_open_cache缓存中, 当MySQL在这个缓存中找不到相应信息时, 才会去磁盘上读取, 默认值64</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 假定系统有200个并发连接, 则需将此参数设置为200*N(N为每个连接所需的文件描述符数目)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 当把table_open_cache设置为很大时, 如果系统处理不了那么多文件描述符, 那么就会出现客户端失效导致连接不上</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># table_open_cache = 128</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 接受的数据包大小；增加该变量的值十分安全, 这是因为仅当需要时才会分配额外内存. 例如, 仅当你发出长查询或MySQLd必须返回大的结果行时MySQLd才会分配更多内存.  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 该变量之所以取较小默认值是一种预防措施, 以捕获客户端和服务器之间的错误信息包, 并确保不会因偶然使用大的信息包而导致内存溢出</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># max_allowed_packet = 4M</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 一个事务, 在没有提交的时候, 产生的日志, 记录到Cache中；等到事务提交需要提交的时候, 则把日志持久化到磁盘. 默认binlog_cache_size大小32K</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># binlog_cache_size = 1M</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 定义了用户可以创建的内存表(memory table)的大小. 这个值用来计算内存表的最大行数值. 这个变量支持动态改变</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># max_heap_table_size = 8M</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL的heap(堆积)表缓冲大小. 所有联合在一个DML指令内完成, 并且大多数联合甚至可以不用临时表即可以完成.  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 大多数临时表是基于内存的(HEAP)表. 具有大的记录长度的临时表 (所有列的长度的和)或包含BLOB列的表存储在硬盘上.  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果某个内部heap(堆积)表大小超过tmp_table_size, MySQL可以根据需要自动将内存中的heap表改为基于硬盘的MyISAM表. 还可以通过设置tmp_table_size选项来增加临时表的大小. 也就是说, 如果调高该值, MySQL同时将增加heap表的大小, 可达到提高联接查询速度的效果</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># tmp_table_size = 16M</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL读入缓冲区大小. 对表进行顺序扫描的请求将分配一个读入缓冲区, MySQL会为它分配一段内存缓冲区. read_buffer_size变量控制这一缓冲区的大小.  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果对表的顺序扫描请求非常频繁, 并且你认为频繁扫描进行得太慢, 可以通过增加该变量值以及内存缓冲区大小提高其性能</span>
</span></span><span style="display:flex;"><span>read_buffer_size <span style="color:#f92672">=</span> 2M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL的随机读缓冲区大小. 当按任意顺序读取行时(例如, 按照排序顺序), 将分配一个随机读缓存区. 进行排序查询时,  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL会首先扫描一遍该缓冲, 以避免磁盘搜索, 提高查询速度, 如果需要排序大量数据, 可适当调高该值. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 但MySQL会为每个客户连接发放该缓冲空间, 所以应尽量适当设置该值, 以避免内存开销过大</span>
</span></span><span style="display:flex;"><span>read_rnd_buffer_size <span style="color:#f92672">=</span> 8M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL执行排序使用的缓冲大小. 如果想要增加ORDER BY的速度, 首先看是否可以让MySQL使用索引而不是额外的排序阶段.  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果不能, 可以尝试增加sort_buffer_size变量的大小</span>
</span></span><span style="display:flex;"><span>sort_buffer_size <span style="color:#f92672">=</span> 8M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 联合查询操作所能使用的缓冲区大小, 和sort_buffer_size一样, 该参数对应的分配内存也是每连接独享</span>
</span></span><span style="display:flex;"><span>join_buffer_size <span style="color:#f92672">=</span> 8M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 这个值(默认8)表示可以重新利用保存在缓存中线程的数量, 当断开连接时如果缓存中还有空间, 那么客户端的线程将被放到缓存中,  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果线程重新被请求, 那么请求将从缓存中读取,如果缓存中是空的或者是新的请求, 那么这个线程将被重新创建,如果有很多新的线程,  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 增加这个值可以改善系统性能.通过比较Connections和Threads_created状态的变量, 可以看到这个变量的作用. (–&gt;表示要调整的值) </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 根据物理内存设置规则如下:  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1G —&gt; 8 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2G —&gt; 16 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3G —&gt; 32 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 大于3G —&gt; 64</span>
</span></span><span style="display:flex;"><span>thread_cache_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL的查询缓冲大小(从4.0.1开始, MySQL提供了查询缓冲机制)使用查询缓冲, MySQL将SELECT语句和查询结果存放在缓冲区中, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 今后对于同样的SELECT语句(区分大小写), 将直接从缓冲区中读取结果. 根据MySQL用户手册, 使用查询缓冲最多可以达到238%的效率. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 通过检查状态值&#39;Qcache_%&#39;, 可以知道query_cache_size设置是否合理: 如果Qcache_lowmem_prunes的值非常大, 则表明经常出现缓冲不够的情况, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果Qcache_hits的值也非常大, 则表明查询缓冲使用非常频繁, 此时需要增加缓冲大小；如果Qcache_hits的值不大, 则表明你的查询重复率很低, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 这种情况下使用查询缓冲反而会影响效率, 那么可以考虑不用查询缓冲. 此外, 在SELECT语句中加入SQL_NO_CACHE可以明确表示不使用查询缓冲</span>
</span></span><span style="display:flex;"><span>query_cache_size <span style="color:#f92672">=</span> 8M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 指定单个查询能够使用的缓冲区大小, 默认1M</span>
</span></span><span style="display:flex;"><span>query_cache_limit <span style="color:#f92672">=</span> 2M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 指定用于索引的缓冲区大小, 增加它可得到更好处理的索引(对所有读和多重写), 到你能负担得起那样多. 如果你使它太大, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 系统将开始换页并且真的变慢了. 对于内存在4GB左右的服务器该参数可设置为384M或512M. 通过检查状态值Key_read_requests和Key_reads, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可以知道key_buffer_size设置是否合理. 比例key_reads/key_read_requests应该尽可能的低, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 至少是1:100, 1:1000更好(上述状态值可以使用SHOW STATUS LIKE &#39;key_read%&#39;获得). 注意: 该参数值设置的过大反而会是服务器整体效率降低</span>
</span></span><span style="display:flex;"><span>key_buffer_size <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 分词词汇最小长度, 默认4</span>
</span></span><span style="display:flex;"><span>ft_min_word_len <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL支持4种事务隔离级别, 他们分别是:  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># READ-UNCOMMITTED, READ-COMMITTED, REPEATABLE-READ, SERIALIZABLE. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如没有指定, MySQL默认采用的是REPEATABLE-READ, ORACLE默认的是READ-COMMITTED</span>
</span></span><span style="display:flex;"><span>transaction_isolation <span style="color:#f92672">=</span> REPEATABLE-READ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>log_bin <span style="color:#f92672">=</span> mysql-bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>binlog_format <span style="color:#f92672">=</span> mixed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 超过30天的binlog删除</span>
</span></span><span style="display:flex;"><span>expire_logs_days <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 错误日志路径</span>
</span></span><span style="display:flex;"><span>log_error <span style="color:#f92672">=</span> /data/mysql/mysql-error.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>slow_query_log <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 慢查询时间 超过1秒则为慢查询</span>
</span></span><span style="display:flex;"><span>long_query_time <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>slow_query_log_file <span style="color:#f92672">=</span> /data/mysql/mysql-slow.log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>performance_schema <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>explicit_defaults_for_timestamp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 表名不区分大小写</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># lower_case_table_names = 1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL选项以避免外部锁定. 该选项默认开启</span>
</span></span><span style="display:flex;"><span>skip-external-locking
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 默认存储引擎</span>
</span></span><span style="display:flex;"><span>default-storage-engine <span style="color:#f92672">=</span> InnoDB
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># InnoDB为独立表空间模式, 每个数据库的每个表都会生成一个数据空间 </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 独立表空间优点:  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1．每个表都有自已独立的表空间.  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2．每个表的数据和索引都会存在自已的表空间中.  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3．可以实现单表在不同的数据库中移动.  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 4．空间可以回收(除drop table操作处, 表空不能自已回收) </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 缺点:  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 单表增加过大, 如超过100G </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 结论:  </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 共享表空间在Insert操作上少有优势. 其它都没独立表空间表现好. 当启用独立表空间时, 请合理调整</span>
</span></span><span style="display:flex;"><span>innodb_file_per_table <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 限制Innodb能打开的表的数据, 如果库里的表特别多的情况, 请增加这个. 这个值默认是300</span>
</span></span><span style="display:flex;"><span>innodb_open_files <span style="color:#f92672">=</span> <span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># InnoDB使用一个缓冲池来保存索引和原始数据, 不像MyISAM. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 这里你设置越大,你在存取表里面数据时所需要的磁盘I/O越少. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 在一个独立使用的数据库服务器上,你可以设置这个变量到服务器物理内存大小的80% </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 不要设置过大,否则,由于物理内存的竞争可能导致操作系统的换页颠簸. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 注意在32位系统上你每个进程可能被限制在 2-3.5G 用户层面内存限制, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 所以不要设置的太高.</span>
</span></span><span style="display:flex;"><span>innodb_buffer_pool_size <span style="color:#f92672">=</span> 64M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># innodb使用后台线程处理数据页上的读写 I/O(输入输出)请求,根据你的 CPU 核数来更改,默认是4</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 注:这两个参数不支持动态改变,需要把该参数加入到my.cnf里, 修改完后重启MySQL服务,允许值的范围从 1-64</span>
</span></span><span style="display:flex;"><span>innodb_write_io_threads <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>innodb_read_io_threads <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 默认设置为 0,表示不限制并发数, 这里推荐设置为0, 更好去发挥CPU多核处理能力, 提高并发量</span>
</span></span><span style="display:flex;"><span>innodb_thread_concurrency <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># InnoDB中的清除操作是一类定期回收无用数据的操作. 在之前的几个版本中, 清除操作是主线程的一部分, 这意味着运行时它可能会堵塞其它的数据库操作. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 从MySQL5.5.X版本开始, 该操作运行于独立的线程中,并支持更多的并发数. 用户可通过设置innodb_purge_threads配置参数来选择清除操作是否使用单</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 独线程,默认情况下参数设置为0(不使用单独线程),设置为 1 时表示使用单独的清除线程. 建议为1</span>
</span></span><span style="display:flex;"><span>innodb_purge_threads <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0: 如果innodb_flush_log_at_trx_commit的值为0,log buffer每秒就会被刷写日志文件到磁盘, 提交事务的时候不做任何操作(执行是由mysql的master thread线程来执行的. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 主线程中每秒会将重做日志缓冲写入磁盘的重做日志文件(REDO LOG)中. 不论事务是否已经提交)默认的日志文件是ib_logfile0,ib_logfile1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1: 当设为默认值1的时候, 每次提交事务的时候, 都会将log buffer刷写到日志. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2: 如果设为2,每次提交事务都会写日志, 但并不会执行刷的操作. 每秒定时会刷到日志文件. 要注意的是, 并不能保证100%每秒一定都会刷到磁盘, 这要取决于进程的调度. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 每次事务提交的时候将数据写入事务日志, 而这里的写入仅是调用了文件系统的写入操作, 而文件系统是有 缓存的, 所以这个写入并不能保证数据已经写入到物理磁盘</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 默认值1是为了保证完整的ACID. 当然, 你可以将这个配置项设为1以外的值来换取更高的性能, 但是在系统崩溃的时候, 你将会丢失1秒的数据. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设为0的话, mysqld进程崩溃的时候, 就会丢失最后1秒的事务. 设为2,只有在操作系统崩溃或者断电的时候才会丢失最后1秒的数据. InnoDB在做恢复的时候会忽略这个值. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 总结 # 设为1当然是最安全的, 但性能页是最差的(相对其他两个参数而言, 但不是不能接受). 如果对数据一致性和完整性要求不高, 完全可以设为2, 如果只最求性能, 例如高并发写的日志服务器, 设为0来获得更高性能</span>
</span></span><span style="display:flex;"><span>innodb_flush_log_at_trx_commit <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 此参数确定些日志文件所用的内存大小, 以M为单位. 缓冲区更大能提高性能, 但意外的故障将会丢失数据. MySQL开发人员建议设置为1－8M之间</span>
</span></span><span style="display:flex;"><span>innodb_log_buffer_size <span style="color:#f92672">=</span> 2M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 此参数确定数据日志文件的大小, 更大的设置可以提高性能, 但也会增加恢复故障数据库所需的时间</span>
</span></span><span style="display:flex;"><span>innodb_log_file_size <span style="color:#f92672">=</span> 32M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 为提高性能, MySQL可以以循环方式将日志文件写到多个文件. 推荐设置为3</span>
</span></span><span style="display:flex;"><span>innodb_log_files_in_group <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># innodb主线程刷新缓存池中的数据, 使脏数据比例小于90%</span>
</span></span><span style="display:flex;"><span>innodb_max_dirty_pages_pct <span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># InnoDB事务在被回滚之前可以等待一个锁定的超时秒数. InnoDB在它自己的锁定表中自动检测事务死锁并且回滚事务. InnoDB用LOCK TABLES语句注意到锁定设置. 默认值是50秒</span>
</span></span><span style="display:flex;"><span>innodb_lock_wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">120</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 批量插入缓存大小,  这个参数是针对MyISAM存储引擎来说的. 适用于在一次性插入100-1000+条记录时,  提高效率. 默认值是8M. 可以针对数据量的大小, 翻倍增加. </span>
</span></span><span style="display:flex;"><span>bulk_insert_buffer_size <span style="color:#f92672">=</span> 8M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MyISAM设置恢复表之时使用的缓冲区的尺寸, 当在REPAIR TABLE或用CREATE INDEX创建索引或ALTER TABLE过程中排序 MyISAM索引分配的缓冲区</span>
</span></span><span style="display:flex;"><span>myisam_sort_buffer_size <span style="color:#f92672">=</span> 8M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果临时文件会变得超过索引, 不要使用快速排序索引方法来创建一个索引. 注释: 这个参数以字节的形式给出</span>
</span></span><span style="display:flex;"><span>myisam_max_sort_file_size <span style="color:#f92672">=</span> 10G
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 如果该值大于1, 在Repair by sorting过程中并行创建MyISAM表索引(每个索引在自己的线程内)</span>
</span></span><span style="display:flex;"><span>myisam_repair_threads <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 服务器关闭交互式连接前等待活动的秒数. 交互式客户端定义为在mysql_real_connect()中使用CLIENT_INTERACTIVE选项的客户端. 默认值: 28800秒(8小时)</span>
</span></span><span style="display:flex;"><span>interactive_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">28800</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 服务器关闭非交互连接之前等待活动的秒数. 在线程启动时, 根据全局wait_timeout值或全局interactive_timeout值初始化会话wait_timeout值, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 取决于客户端类型(由mysql_real_connect()的连接选项CLIENT_INTERACTIVE定义). 参数默认值: 28800秒(8小时)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># MySQL服务器所支持的最大连接数是有上限的, 因为每个连接的建立都会消耗内存, 因此我们希望客户端在连接到MySQL Server处理完相应的操作后, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 应该断开连接并释放占用的内存. 如果你的MySQL Server有大量的闲置连接, 他们不仅会白白消耗内存, 而且如果连接一直在累加而不断开, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 最终肯定会达到MySQL Server的连接上限数, 这会报&#39;too many connections&#39;的错误. 对于wait_timeout的值设定, 应该根据系统的运行情况来判断. </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 在系统运行一段时间后, 可以通过show processlist命令查看当前系统的连接状态, 如果发现有大量的sleep状态的连接进程, 则说明该参数设置的过大, </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 可以进行适当的调整小些. 要同时设置interactive_timeout和wait_timeout才会生效. </span>
</span></span><span style="display:flex;"><span>wait_timeout <span style="color:#f92672">=</span> <span style="color:#ae81ff">28800</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>mysqldump<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>quick
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 服务器发送和接受的最大包长度</span>
</span></span><span style="display:flex;"><span>max_allowed_packet <span style="color:#f92672">=</span> 16M
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>myisamchk<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>key_buffer_size <span style="color:#f92672">=</span> 8M
</span></span><span style="display:flex;"><span>sort_buffer_size <span style="color:#f92672">=</span> 8M
</span></span><span style="display:flex;"><span>read_buffer <span style="color:#f92672">=</span> 4M
</span></span><span style="display:flex;"><span>write_buffer <span style="color:#f92672">=</span> 4M
</span></span></code></pre></div><h2 id="references">
  References
  <a class="anchor" href="#references">#</a>
</h2>
<p><a href="https://blog.csdn.net/winerpro/article/details/129918402">关于mysql配置文件的介绍</a></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#基础配置">基础配置</a></li>
    <li><a href="#mt生产环境服务器配置">MT生产环境服务器配置</a></li>
    <li><a href="#配置解析">配置解析</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












